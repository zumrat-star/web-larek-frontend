# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Мы проектируем приложение с использованием паттерна MVP (Model-View-Presenter). 
 Паттерн MVP разделяет приложение на три основных слоя:
 1. Model (Модель) - отвечает за данные и бизнес-логику. 
    В нашем случае это классы, которые представляют товары, корзину, заказы, а также классы для работы с API.
 2. View (Представление) - отвечает за отображение данных и взаимодействие с пользователем. 
    Это классы, которые управляют отображением товаров, корзины, модальных окон и т.д.
 3. Presenter (Презентер) - посредник между Model и View. 
    Он обрабатывает пользовательские события, обновляет модель и обновляет представление.
 За что отвечает каждый слой:
 - Model: 
   * Хранение данных (товары, корзина, заказы)
   * Валидация данных
   * Логика работы с данными (добавление в корзину, оформление заказа)
 - View:
   * Отображение данных (рендеринг товаров, корзины, модальных окон)
   * Передача пользовательских событий презентеру (клик на товар, добавление в корзину, оформление заказа)
 - Presenter:
   * Обработка событий от View
   * Запрос данных из Model
   * Обновление View в ответ на изменения данных
   * Оркестрация бизнес-логики


## Архитектура и описание

1. Model (Модель)
Отвечает за данные и бизнес-логику.
Классы моделей:

ApiModel - работа с API сервера
DataModel - хранение данных о товарах
BasketModel - управление корзиной покупок
FormModel - управление и валидация данных форм

2. View (Представление)
Отвечает за отображение данных и взаимодействие с пользователем.

Базовые классы:
Component - базовый класс для всех компонентов
Form - базовый класс для форм

Компоненты:
Header - шапка сайта со счетчиком и кнопкой корзины
Catalog - каталог товаров на главной странице
Card - карточка товара в каталоге
CardPreview - детальная информация о товаре
Basket - содержимое корзины в модальном окне
BasketItem - элемент корзины
OrderForm - форма оформления заказа
ContactsForm - форма контактов
Success - уведомление об успешном заказе
Modal - универсальное модальное окно

3. Presenter (Презентер)
Связующий слой между Model и View, реализованный в index.ts.

### Базовые классы

#### Api (Базовый класс для ApiModel)
**Назначение:** Инкапсулирует логику HTTP-запросов к серверу, предоставляя базовые методы для работы с API.
*   `protected handleResponse(response: Response): Promise<object>` - обрабатывает ответ сервера, проверяет статус и парсит JSON.
*   `get(url: string): Promise<object>` - выполняет GET-запрос по указанному URL.
*   `post(url: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - выполняет POST, PUT или DELETE запрос (в зависимости от аргумента `method`).

### Модели (Models)

Модели отвечают за хранение, валидацию и логику работы с данными.

#### ApiModel
**Назначение:** Наследует от `Api`. Содержит специфичные для доменной логики методы для взаимодействия с серверным API.
**Поля:**`cdn: string` - базовый URL для загрузки изображений товаров (из атрибута `src` в `template#card-catalog`).
**Методы**
*   `getListProductCard(): Promise<ICard[]> ` - запрашивает и возвращает массив карточек товаров.
*   `postOrderLot(order: IOrder): Promise<IOrderResult> ` - отправляет данные заказа на сервер и возвращает ответ (например, ID заказа).

#### DataModel
**Назначение:** Хранит данные о товарах, полученные с сервера, и состояние UI (например, выбранную для preview карточку).
**Поля:**
*  `catalog: ICard[]` - массив всех товаров, загруженных с сервера.
*  `preview: string | null` - ID товара, который в данный момент просматривает пользователь.
**Методы**
*   `setPreview(card: ICard | null): void` - сохраняет данные карточки, которую просматривает пользователь.

#### BasketModel
**Назначение:** Управляет состоянием корзины покупок (добавление, удаление, расчет итогов).
**Поля:** `items: Map<string, ICard>` - хранилище товаров в корзине, где ключ - ID товара, значение - данные товара.
**Методы**
*   `getCounter(): number` - возвращает общее количество товарных позиций в корзине.
*   `getSumAllProducts(): number` - вычисляет и возвращает общую стоимость всех товаров в корзине.
*   `setSelectedCard(card: ICard): void` - добавляет товар в корзину.
*   `deleteCardToBasket(id: string): void` - удаляет товар из корзины по ID.
*   `clearBasketProducts(): void` - полностью очищает корзину.
*   `checkProductInBasket(id: string): boolean` - проверяет наличие товара в корзине.

#### FormModel
**Назначение:** Управляет данными формы заказа (адрес, контакты, способ оплаты) и их валидацией.
**Поля:**
*   `order: IOrder` - объект для хранения данных заказа.
*   `validationErrors: { [field: string]: string }` - объект для хранения ошибок валидации.
**Методы**
*   `setPaymentMethod(method: 'online' | 'offline'): void` - сохраняет способ оплаты.
*   `setOrderAddress(address: string): void` - сохраняет адрес доставки.
*   `setOrderEmail(email: string): void` - сохраняет email.
*   `setOrderPhone(phone: string): void` - сохраняет телефон.
*   `validateOrder(): boolean` - проверяет корректность данных заказа.
*   `validateContacts(): boolean` - проверяет корректность контактных данных.
*   `getOrderData(): IOrder` - возвращает данные для отправки на сервер.
*   `clearFormData(): void` - очищает данные формы после успешного заказа.

### Представления (Views / Компоненты)

Компоненты отвечают за отображение данных и взаимодействие с пользователем.

#### Component (Базовый класс)
**Назначение:** Базовый класс для всех компонентов, обеспечивающий общую функциональность.
**Поля:**
*   `container: HTMLElement` - контейнер компонента
**Методы:**
*   `constructor(container: HTMLElement)` - инициализация компонента
*   `setText(element: HTMLElement, value: string)` - установка текстового содержимого
*   `setDisabled(element: HTMLElement, state: boolean)` - установка состояния disabled
*   `render(data?: object): HTMLElement` - основной метод рендеринга

#### Catalog
**Назначение**Отображает каталог товаров на главной странице.
**Поля**
* _container: HTMLElement - контейнер каталога
* _emptyPlaceholder: HTMLElement | null - элемент-заглушка при отсутствии товаров
**Методы**
*   render(items: ICard[]) - отрисовывает каталог товаров. Создает экземпляры `Card` для каждого товара и добавляет их в контейнер.
*   update(items: ICard[]) - обновляет каталог
*   clear() - очищает каталог

#### Form (Базовый класс для форм)
**Назначение:** Базовый класс для всех форм в приложении.
**Поля:**
*   `_submit: HTMLButtonElement` - кнопка отправки формы
*   `_errors: HTMLElement` - контейнер для ошибок
**Методы:**
*   `constructor(container: HTMLFormElement, events: IEvents)` - инициализация формы
*   `onInputChange(field: keyof T, value: string)` - обработчик изменения поля
*   `set valid(value: boolean)` - установка валидности формы
*   `set errors(value: string)` - установка текста ошибок
*   `render(state: Partial<T> & IFormState)` - рендеринг формы

#### Modal (Модальное окно)
**Назначение:** Универсальное модальное окно для отображения любого контента
**Поля:**
*   `_closeButton: HTMLButtonElement` - кнопка закрытия
*   `_content: HTMLElement` - контейнер для контента
*   `_container: HTMLElement` - контейнер модального окна.
**Методы:**
* set content(value: HTMLElement) - устанавливает содержимое
* open() - открывает модальное окно
* close() - закрывает модальное окно
* render(data: IModalData): HTMLElement 

#### Card
**Назначение:** Отображает карточку товара в списке. Рендерит себя на основе `template#card-catalog`.
**Поля:**
*   `_categoryElement: HTMLSpanElement` - элемент с классом `card__category` - категория товара
*   `_titleElement: HTMLHeadingElement` - элемент с классом `card__title` - наззвание товара
*   `_imageElement: HTMLImageElement` - элемент с классом `card__image` - изображение товара
*   `_priceElement: HTMLSpanElement` - элемент с классом `card__price` - стоимость товара
**Методы:**
*   `render(data: ICard): HTMLElement` - основной метод, который создает карточку из шаблона, наполняет её переданными данными и возвращает готовый DOM-элемент.

#### CardPreview
**Назначение:** Отображает детальную информацию о товаре в модальном окне. Рендерит подробное описание товара на основе `template#card-preview`.
**Поля:**
* _description: HTMLParagraphElement - элемент описания товара
* _button: HTMLButtonElement - кнопка "В корзину"/"Убрать из корзины"
* _title: HTMLHeadingElement - элемент названия товара
* _image: HTMLImageElement - элемент изображения товара
* _price: HTMLSpanElement - элемент цены товара
* _category: HTMLSpanElement - элемент категории товара
**Методы**
* setButtonHandler(handler: () => void) - устанавливает обработчик кнопки
* render(data: ICard & { inBasket: boolean }) - отрисовывает детальную информацию о товаре

#### Header 
**Назначение:** Отвечает за отображение шапки сайта, включая счетчик товаров в корзине и кнопку открытия корзины.
**Поля:**
*   `_counter: HTMLElement` - элемент счетчика товаров в корзине.
*   `_basketButton: HTMLButtonElement` - кнопка открытия корзины.
**Методы:**
*  updateCounter(count: number) - обновляет счетчик товаров
*  setBasketButtonHandler(handler: () => void) - устанавливает обработчик клика на кнопку корзины

#### Basket 
**Назначение:** Отображает содержимое корзины в модальном окне (список товаров, общую сумму и кнопку оформления заказа). Работает только с элементами своего шаблона.
**Поля:**
*   `_list: HTMLElement` - контейнер для списка товаров.
*   `_total: HTMLElement` - элемент для отображения общей суммы.
*   `_button: HTMLButtonElement` - кнопка оформления заказа.
**Методы:**
*   `renderList(items: ICard[])` - отрисовывает список товаров в корзине.
*   `updateTotal(sum: number)` - обновляет общую сумму.
*   `setButtonState(disabled: boolean)` - устанавливает состояние кнопки оформления заказа (активна/неактивна).

#### BasketItem
**Назначение:** Отображает одну позицию товара внутри корзины. Рендерит себя на основе `template#card-basket`.
**Поля:**
*   `_indexElement: HTMLSpanElement` - элемент для порядкового номера (с классом `basket__item-index`).
*   `_titleElement: HTMLSpanElement` - элемент названия товара.
*   `_priceElement: HTMLSpanElement` - элемент цены товара.
*   `_deleteButtonElement: HTMLButtonElement` - кнопка удаления товара из корзины.
**Методы**
*   `render(data: ICard, index: number): HTMLElement` - создает и возвращает элемент позиции.
*   `setDeleteHandler(handler: () => void): void` - устанавливает обработчик удаления.

#### OrderForm (наследуется от Form)
**Назначение:** Форма оформления заказа (способ оплаты и адрес доставки).
**Поля:**
*   `_paymentButtons: NodeListOf<HTMLButtonElement>` - кнопки выбора оплаты
*   `_addressInput: HTMLInputElement` - поле ввода адреса
**Методы:**
* setPaymentMethod(method: string) - устанавливает способ оплаты
* setAddress(address: string) - устанавливает адрес доставки

#### ContactsForm (наследуется от Form)
**Назначение:** Форма ввода контактных данных.
**Поля:**
*   `_emailInput: HTMLInputElement` - поле ввода email
*   `_phoneInput: HTMLInputElement` - поле ввода телефона
**Методы:**
* setEmail(email: string) - устанавливает email
* setPhone(phone: string) - устанавливает телефон


#### Success
**Назначение:** Отображает уведомление об успешном оформлении заказа.Рендерит себя на основе `template#success`.
**Поля:**
*   `_totalElement: HTMLParagraphElement` - элемент для отображения списанной суммы (с классом `order-success__description`).
*   `_closeButton: HTMLButtonElement` - кнопка закрытия окна ("За новыми покупками!").
**Методы:**
* render(total: number) - отрисовывает уведомление

### Презентер (index.ts)
В файле `index.ts` будет содержаться код, который связывает модели и представления. Он будет выполнять следующие функции:
1. Инициализация приложения:
   - Создание экземпляров моделей (ApiModel, BasketModel, DataModel, FormModel).
   - Создание экземпляров представлений (Card, Basket, Modal и др.).
   - Настройка обработчиков событий.
2. Подписка на события:
   - Подписка представлений на изменения в моделях (например, обновление корзины).
   - Подписка моделей на события от представлений (например, добавление товара в корзину).
3. Обработка событий пользовательского интерфейса:
   - Открытие модальных окон.
   - Добавление/удаление товаров из корзины.
   - Оформление заказа.
4. Валидация форм и управление состоянием кнопок.



#### 1. Основные части архитектуры
Архитектура проекта состоит из трех основных частей:
*   **Данные (Models):** `ApiModel`, `BasketModel`, `DataModel`, `FormModel`. Отвечают за бизнес-логику, хранение и валидацию данных.
*   **Отображение (Views/Components):** `Card`, `Basket`, `Modal` и др. Отвечают за рендеринг UI и реакцию на действия пользователя.
*   **Связующий слой (Event Bus):** `EventEmitter`. Обеспечивает взаимодействие между Моделями и Представлениями без создания прямых ссылок.

#### 2. Функции и взаимодействие частей
*   **Модели** хранят состояние приложения (товары, корзина, данные формы) и содержат логику его изменения. Они уведомляют о своих изменениях через `EventEmitter`.
*   **Компоненты** отображают текущее состояние, полученное от Моделей, и переводят действия пользователя (клики, ввод) в события, которые также отправляются через `EventEmitter`.
*   **EventEmitter** является центральной "шиной событий". Компоненты подписываются на события от Моделей (например, `basket:changed`), чтобы обновить свой вид. Модели подписываются на события от Компонентов (например, `card:add-to-basket`), чтобы обновить свое состояние.

#### 3. Используемые данные
*   `ICard`: Интерфейс данных карточки товара (id, название, цена, описание, категория и т.д.).
*   `IOrder`: Интерфейс для данных заказа, объединяющий выбранные товары (`items`), итоговую сумму (`total`), адрес (`address`), способ оплаты (`payment`) и контакты (`email`, `phone`). Формируется в `FormModel`.
*   `IContacts`: Интерфейс для контактных данных ({ email: string, phone: string }).
*   `IOrderResult`: Интерфейс ответа сервера на успешный заказ (например, { id: string }).

#### 4. Компоненты приложения
Приложение состоит из компонентов, отображающих:
- `Catalog` - каталог товаров на главной странице
- `Card` - карточка товара в каталоге
- `CardPreview` - детальная информация о товаре (не наследуется от Card, а использует тот же template)
- `Basket` - управление корзиной (счетчик, кнопка открытия, список товаров)
- `BasketItem` - элемент корзины
- `OrderForm` - форма заказа
- `ContactsForm` - форма контактов
- `Success` - успешное оформление заказа (теперь это просто компонент, который рендерит содержимое для модального окна)
- `Modal` - универсальное модальное окно

## Взаимодействие компонентов (обновленное)
### Добавление товара в корзину:
Пользователь нажимает "В корзину" в CardPreview
CardPreview генерирует событие card:add-to-basket
Презентер в index.ts получает событие и вызывает basketModel.setSelectedCard()
BasketModel добавляет товар и генерирует событие basket:changed
Презентер получает событие и запрашивает актуальные данные: basketModel.getCounter() и basketModel.getSumAllProducts()
Презентер вызывает header.updateCounter(count) для обновления счетчика в шапке
Если корзина открыта, презентер также обновляет содержимое модального окна корзины

### Открытие корзины:
Пользователь нажимает на иконку корзины в шапке сайта (компонент Header)
Header генерирует событие basket:open
Презентер получает событие, создает экземпляр Basket и наполняет его актуальными данными
Презентер создает экземпляр Modal и устанавливает содержимое - элемент Basket
Презентер открывает модальное окно

### Оформление заказа:
В модальном окне корзины пользователь нажимает кнопку оформления заказа
Basket генерирует событие order:open
Презентер получает событие, создает экземпляр OrderForm
Презентер создает экземпляр Modal и устанавливает содержимое - форму заказа
Презентер открывает модальное окно с формой заказа
После заполнения формы заказа пользователь нажимает "Далее"
Презентер создает экземпляр ContactsForm и открывает модальное окно с формой контактов
После заполнения формы контактов и успешной валидации презентер отправляет заказ через ApiModel
После успешного оформления заказа презентер создает экземпляр Success и открывает модальное окно с уведомлением
